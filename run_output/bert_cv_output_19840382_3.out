Unloading StdEnv/2020

Due to MODULEPATH changes, the following have been reloaded:
  1) mii/1.1.1


The following have been reloaded with a version change:
  1) python/3.8.2 => python/3.7.4

Using base prefix '/cvmfs/soft.computecanada.ca/easybuild/software/2017/Core/python/3.7.4'
New python executable in /localscratch/yinan.19849003.0/env/bin/python
Installing setuptools, pip, wheel...
done.
Ignoring pip: markers 'python_version < "3"' don't match your environment
Looking in links: /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/nix/avx2, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/nix/generic, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic
Collecting numpy==1.20.0
  ERROR: Could not find a version that satisfies the requirement numpy==1.20.0 (from versions: 1.15.0+computecanada, 1.15.2+computecanada, 1.15.4+computecanada, 1.16.0+computecanada, 1.16.2+computecanada, 1.16.3+computecanada, 1.17.4+computecanada, 1.18.1+computecanada, 1.18.4+computecanada, 1.19.1+computecanada, 1.19.2+computecanada, 1.20.2+computecanada)
ERROR: No matching distribution found for numpy==1.20.0
Ignoring pip: markers 'python_version < "3"' don't match your environment
Looking in links: /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/nix/avx2, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/nix/generic, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic
Collecting torch
Collecting typing-extensions (from torch)
Installing collected packages: typing-extensions, torch
Successfully installed torch-1.9.1+computecanada typing-extensions-4.0.0+computecanada
Ignoring pip: markers 'python_version < "3"' don't match your environment
Looking in links: /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/nix/avx2, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/nix/generic, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic
Collecting Keras (from -r requirements.txt (line 1))
Collecting Keras_Preprocessing (from -r requirements.txt (line 2))
Collecting nltk==3.5 (from -r requirements.txt (line 3))
Collecting scikit-learn==0.22.1 (from -r requirements.txt (line 4))
Collecting tensorboard==2.3.0+computecanada (from -r requirements.txt (line 5))
Collecting tensorboard_plugin_wit==1.7.0 (from -r requirements.txt (line 6))
Collecting tensorflow_gpu==2.3.0+computecanada (from -r requirements.txt (line 7))
Collecting tensorflow_estimator==2.3.0 (from -r requirements.txt (line 8))
Collecting tokenizers==0.5.2 (from -r requirements.txt (line 9))
Collecting torchtext==0.6.0 (from -r requirements.txt (line 10))
Collecting transformers==2.5.1+computecanada (from -r requirements.txt (line 11))
Requirement already satisfied: numpy>=1.9.1 in /cvmfs/soft.computecanada.ca/easybuild/software/2017/Core/scipy-stack/2019a/lib/python3.7/site-packages (from Keras_Preprocessing->-r requirements.txt (line 2)) (1.16.0)
Requirement already satisfied: six>=1.9.0 in /cvmfs/soft.computecanada.ca/easybuild/software/2017/Core/scipy-stack/2019a/lib/python3.7/site-packages (from Keras_Preprocessing->-r requirements.txt (line 2)) (1.12.0)
Collecting joblib (from nltk==3.5->-r requirements.txt (line 3))
Collecting tqdm (from nltk==3.5->-r requirements.txt (line 3))
Collecting regex (from nltk==3.5->-r requirements.txt (line 3))
Collecting click (from nltk==3.5->-r requirements.txt (line 3))
Requirement already satisfied: scipy>=0.17.0 in /cvmfs/soft.computecanada.ca/easybuild/software/2017/Core/scipy-stack/2019a/lib/python3.7/site-packages (from scikit-learn==0.22.1->-r requirements.txt (line 4)) (1.2.0)
Collecting grpcio>=1.24.3 (from tensorboard==2.3.0+computecanada->-r requirements.txt (line 5))
Requirement already satisfied: setuptools>=41.0.0 in /localscratch/yinan.19849003.0/env/lib/python3.7/site-packages (from tensorboard==2.3.0+computecanada->-r requirements.txt (line 5)) (41.0.1)
Collecting google-auth<2,>=1.6.3 (from tensorboard==2.3.0+computecanada->-r requirements.txt (line 5))
Collecting absl-py>=0.4 (from tensorboard==2.3.0+computecanada->-r requirements.txt (line 5))
Collecting google-auth-oauthlib<0.5,>=0.4.1 (from tensorboard==2.3.0+computecanada->-r requirements.txt (line 5))
Collecting protobuf>=3.6.0 (from tensorboard==2.3.0+computecanada->-r requirements.txt (line 5))
Collecting markdown>=2.6.8 (from tensorboard==2.3.0+computecanada->-r requirements.txt (line 5))
Requirement already satisfied: requests<3,>=2.21.0 in /cvmfs/soft.computecanada.ca/easybuild/software/2017/Core/scipy-stack/2019a/lib/python3.7/site-packages (from tensorboard==2.3.0+computecanada->-r requirements.txt (line 5)) (2.21.0)
Collecting werkzeug>=0.11.15 (from tensorboard==2.3.0+computecanada->-r requirements.txt (line 5))
Requirement already satisfied: wheel>=0.26; python_version >= "3" in /localscratch/yinan.19849003.0/env/lib/python3.7/site-packages (from tensorboard==2.3.0+computecanada->-r requirements.txt (line 5)) (0.33.4)
Collecting h5py<2.11.0,>=2.10.0 (from tensorflow_gpu==2.3.0+computecanada->-r requirements.txt (line 7))
Collecting termcolor>=1.1.0 (from tensorflow_gpu==2.3.0+computecanada->-r requirements.txt (line 7))
Collecting google-pasta>=0.1.8 (from tensorflow_gpu==2.3.0+computecanada->-r requirements.txt (line 7))
Collecting astunparse==1.6.3 (from tensorflow_gpu==2.3.0+computecanada->-r requirements.txt (line 7))
Collecting wrapt>=1.11.1 (from tensorflow_gpu==2.3.0+computecanada->-r requirements.txt (line 7))
Collecting opt-einsum>=2.3.2 (from tensorflow_gpu==2.3.0+computecanada->-r requirements.txt (line 7))
Collecting gast==0.3.3 (from tensorflow_gpu==2.3.0+computecanada->-r requirements.txt (line 7))
Collecting sentencepiece (from torchtext==0.6.0->-r requirements.txt (line 10))
Requirement already satisfied: torch in /localscratch/yinan.19849003.0/env/lib/python3.7/site-packages (from torchtext==0.6.0->-r requirements.txt (line 10)) (1.9.1+computecanada)
Collecting boto3 (from transformers==2.5.1+computecanada->-r requirements.txt (line 11))
Collecting filelock (from transformers==2.5.1+computecanada->-r requirements.txt (line 11))
Collecting sacremoses (from transformers==2.5.1+computecanada->-r requirements.txt (line 11))
Requirement already satisfied: importlib-metadata; python_version < "3.8" in /cvmfs/soft.computecanada.ca/easybuild/software/2017/Core/scipy-stack/2019a/lib/python3.7/site-packages (from click->nltk==3.5->-r requirements.txt (line 3)) (0.8)
Collecting cachetools<5.0,>=2.0.0 (from google-auth<2,>=1.6.3->tensorboard==2.3.0+computecanada->-r requirements.txt (line 5))
Collecting rsa<5,>=3.1.4; python_version >= "3.6" (from google-auth<2,>=1.6.3->tensorboard==2.3.0+computecanada->-r requirements.txt (line 5))
Collecting pyasn1-modules>=0.2.1 (from google-auth<2,>=1.6.3->tensorboard==2.3.0+computecanada->-r requirements.txt (line 5))
Collecting requests-oauthlib>=0.7.0 (from google-auth-oauthlib<0.5,>=0.4.1->tensorboard==2.3.0+computecanada->-r requirements.txt (line 5))
Requirement already satisfied: chardet<3.1.0,>=3.0.2 in /cvmfs/soft.computecanada.ca/easybuild/software/2017/Core/scipy-stack/2019a/lib/python3.7/site-packages (from requests<3,>=2.21.0->tensorboard==2.3.0+computecanada->-r requirements.txt (line 5)) (3.0.4)
Requirement already satisfied: idna<2.9,>=2.5 in /cvmfs/soft.computecanada.ca/easybuild/software/2017/Core/scipy-stack/2019a/lib/python3.7/site-packages (from requests<3,>=2.21.0->tensorboard==2.3.0+computecanada->-r requirements.txt (line 5)) (2.8)
Requirement already satisfied: urllib3<1.25,>=1.21.1 in /cvmfs/soft.computecanada.ca/easybuild/software/2017/Core/scipy-stack/2019a/lib/python3.7/site-packages (from requests<3,>=2.21.0->tensorboard==2.3.0+computecanada->-r requirements.txt (line 5)) (1.24.1)
Requirement already satisfied: certifi>=2017.4.17 in /cvmfs/soft.computecanada.ca/easybuild/software/2017/Core/scipy-stack/2019a/lib/python3.7/site-packages (from requests<3,>=2.21.0->tensorboard==2.3.0+computecanada->-r requirements.txt (line 5)) (2018.11.29)
Requirement already satisfied: typing-extensions in /localscratch/yinan.19849003.0/env/lib/python3.7/site-packages (from torch->torchtext==0.6.0->-r requirements.txt (line 10)) (4.0.0+computecanada)
Collecting botocore<1.22.0,>=1.21.1 (from boto3->transformers==2.5.1+computecanada->-r requirements.txt (line 11))
Collecting jmespath<1.0.0,>=0.7.1 (from boto3->transformers==2.5.1+computecanada->-r requirements.txt (line 11))
Collecting s3transfer<0.6.0,>=0.5.0 (from boto3->transformers==2.5.1+computecanada->-r requirements.txt (line 11))
Requirement already satisfied: zipp>=0.3.2 in /cvmfs/soft.computecanada.ca/easybuild/software/2017/Core/scipy-stack/2019a/lib/python3.7/site-packages (from importlib-metadata; python_version < "3.8"->click->nltk==3.5->-r requirements.txt (line 3)) (0.3.3)
Requirement already satisfied: pyasn1>=0.1.3 in /cvmfs/soft.computecanada.ca/easybuild/software/2017/Core/scipy-stack/2019a/lib/python3.7/site-packages (from rsa<5,>=3.1.4; python_version >= "3.6"->google-auth<2,>=1.6.3->tensorboard==2.3.0+computecanada->-r requirements.txt (line 5)) (0.4.3)
Collecting oauthlib>=3.0.0 (from requests-oauthlib>=0.7.0->google-auth-oauthlib<0.5,>=0.4.1->tensorboard==2.3.0+computecanada->-r requirements.txt (line 5))
Requirement already satisfied: python-dateutil<3.0.0,>=2.1 in /cvmfs/soft.computecanada.ca/easybuild/software/2017/Core/scipy-stack/2019a/lib/python3.7/site-packages (from botocore<1.22.0,>=1.21.1->boto3->transformers==2.5.1+computecanada->-r requirements.txt (line 11)) (2.7.5)
ERROR: pyasn1-modules 0.2.8+computecanada has requirement pyasn1<0.5.0,>=0.4.6, but you'll have pyasn1 0.4.3 which is incompatible.
ERROR: tensorflow-gpu 2.3.0+computecanada has requirement scipy==1.4.1, but you'll have scipy 1.2.0 which is incompatible.
ERROR: botocore 1.21.1+computecanada has requirement urllib3<1.27,>=1.25.4, but you'll have urllib3 1.24.1 which is incompatible.
Installing collected packages: Keras, Keras-Preprocessing, joblib, tqdm, regex, click, nltk, scikit-learn, grpcio, tensorboard-plugin-wit, cachetools, rsa, pyasn1-modules, google-auth, absl-py, oauthlib, requests-oauthlib, google-auth-oauthlib, protobuf, markdown, werkzeug, tensorboard, h5py, termcolor, google-pasta, astunparse, tensorflow-estimator, wrapt, opt-einsum, gast, tensorflow-gpu, tokenizers, sentencepiece, torchtext, jmespath, botocore, s3transfer, boto3, filelock, sacremoses, transformers
Successfully installed Keras-2.7.0+computecanada Keras-Preprocessing-1.1.2+computecanada absl-py-0.15.0+computecanada astunparse-1.6.3+computecanada boto3-1.18.1+computecanada botocore-1.21.1+computecanada cachetools-4.2.4+computecanada click-8.0.3+computecanada filelock-3.3.2+computecanada gast-0.3.3+computecanada google-auth-1.35.0+computecanada google-auth-oauthlib-0.4.6+computecanada google-pasta-0.2.0+computecanada grpcio-1.38.0+computecanada h5py-2.10.0+computecanada jmespath-0.10.0+computecanada joblib-1.1.0+computecanada markdown-3.3.4+computecanada nltk-3.5+computecanada oauthlib-3.1.1+computecanada opt-einsum-3.3.0+computecanada protobuf-3.19.1+computecanada pyasn1-modules-0.2.8+computecanada regex-2020.11.13+computecanada requests-oauthlib-1.3.0+computecanada rsa-4.7.2+computecanada s3transfer-0.5.0+computecanada sacremoses-0.0.46+computecanada scikit-learn-0.22.1+computecanada sentencepiece-0.1.91+computecanada tensorboard-2.3.0+computecanada tensorboard-plugin-wit-1.7.0+computecanada tensorflow-estimator-2.3.0+computecanada tensorflow-gpu-2.3.0+computecanada termcolor-1.1.0+computecanada tokenizers-0.5.2+computecanada torchtext-0.6.0+computecanada tqdm-4.62.0+computecanada transformers-2.5.1+computecanada werkzeug-2.0.2+computecanada wrapt-1.11.2+computecanada
Starting Task
2021-11-21 23:30:09.778150: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcudart.so.10.1
Traceback (most recent call last):
  File "bert_cv.py", line 356, in <module>
    es_flag, loss_default = train(i, train_dataloader, loss_default)
  File "bert_cv.py", line 88, in train
    outputs = model(b_input_ids, token_type_ids=None, attention_mask=b_input_mask, labels=b_labels)
  File "/localscratch/yinan.19849003.0/env/lib/python3.7/site-packages/torch/nn/modules/module.py", line 1051, in _call_impl
    return forward_call(*input, **kwargs)
  File "/localscratch/yinan.19849003.0/env/lib/python3.7/site-packages/transformers/modeling_bert.py", line 1176, in forward
    inputs_embeds=inputs_embeds,
  File "/localscratch/yinan.19849003.0/env/lib/python3.7/site-packages/torch/nn/modules/module.py", line 1051, in _call_impl
    return forward_call(*input, **kwargs)
  File "/localscratch/yinan.19849003.0/env/lib/python3.7/site-packages/transformers/modeling_bert.py", line 790, in forward
    encoder_attention_mask=encoder_extended_attention_mask,
  File "/localscratch/yinan.19849003.0/env/lib/python3.7/site-packages/torch/nn/modules/module.py", line 1051, in _call_impl
    return forward_call(*input, **kwargs)
  File "/localscratch/yinan.19849003.0/env/lib/python3.7/site-packages/transformers/modeling_bert.py", line 407, in forward
    hidden_states, attention_mask, head_mask[i], encoder_hidden_states, encoder_attention_mask
  File "/localscratch/yinan.19849003.0/env/lib/python3.7/site-packages/torch/nn/modules/module.py", line 1051, in _call_impl
    return forward_call(*input, **kwargs)
  File "/localscratch/yinan.19849003.0/env/lib/python3.7/site-packages/transformers/modeling_bert.py", line 368, in forward
    self_attention_outputs = self.attention(hidden_states, attention_mask, head_mask)
  File "/localscratch/yinan.19849003.0/env/lib/python3.7/site-packages/torch/nn/modules/module.py", line 1051, in _call_impl
    return forward_call(*input, **kwargs)
  File "/localscratch/yinan.19849003.0/env/lib/python3.7/site-packages/transformers/modeling_bert.py", line 314, in forward
    hidden_states, attention_mask, head_mask, encoder_hidden_states, encoder_attention_mask
  File "/localscratch/yinan.19849003.0/env/lib/python3.7/site-packages/torch/nn/modules/module.py", line 1051, in _call_impl
    return forward_call(*input, **kwargs)
  File "/localscratch/yinan.19849003.0/env/lib/python3.7/site-packages/transformers/modeling_bert.py", line 234, in forward
    attention_scores = torch.matmul(query_layer, key_layer.transpose(-1, -2))
RuntimeError: CUDA out of memory. Tried to allocate 96.00 MiB (GPU 0; 31.75 GiB total capacity; 3.48 GiB already allocated; 85.00 MiB free; 3.52 GiB reserved in total by PyTorch)
